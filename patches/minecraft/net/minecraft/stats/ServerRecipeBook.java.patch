--- a/net/minecraft/stats/ServerRecipeBook.java
+++ b/net/minecraft/stats/ServerRecipeBook.java
@@ -29,7 +_,7 @@
 
       for(RecipeHolder<?> recipeholder : p_12792_) {
          ResourceLocation resourcelocation = recipeholder.f_291676_();
-         if (!this.f_12680_.contains(resourcelocation) && !recipeholder.f_291008_().m_5598_()) {
+         if (!this.f_12680_.contains(resourcelocation) && !recipeholder.f_291008_().m_5598_() && org.bukkit.craftbukkit.v1_20_R2.event.CraftEventFactory.handlePlayerRecipeListUpdateEvent(p_12793_, resourcelocation)) { // CraftBukkit
             this.m_12702_(resourcelocation);
             this.m_12719_(resourcelocation);
             list.add(resourcelocation);
@@ -63,6 +_,7 @@
    }
 
    private void m_12801_(ClientboundRecipePacket.State p_12802_, ServerPlayer p_12803_, List<ResourceLocation> p_12804_) {
+      if (p_12803_.f_8906_ == null) return; // SPIGOT-4478 during PlayerLoginEvent
       p_12803_.f_8906_.m_141995_(new ClientboundRecipePacket(p_12802_, p_12804_, Collections.emptyList(), this.m_12684_()));
    }
 
